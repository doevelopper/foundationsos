# uboot-tpm.config — U-Boot config fragment for FoundationsOS RPi3B+
#
# Applied on top of rpi_arm64_defconfig.
# Same policy as the RPi5 fragment; Cortex-A53 compatible.

# ─── FIT image & verified boot ────────────────────────────────────────────────
CONFIG_FIT=y
CONFIG_FIT_SIGNATURE=y
CONFIG_FIT_VERBOSE=y
CONFIG_LEGACY_IMAGE_FORMAT=y
CONFIG_BOOTSTD_DEFAULTS=y
CONFIG_BOOTSTD_FULL=y

# ─── Boot environment (FAT on mmcblk0p1) ─────────────────────────────────────
CONFIG_ENV_IS_IN_FAT=y
CONFIG_ENV_FAT_INTERFACE="mmc"
CONFIG_ENV_FAT_DEVICE_AND_PART="0:1"
CONFIG_ENV_FAT_FILE="uboot.env"
CONFIG_ENV_SIZE=0x4000

# ─── RAUC boot selection ──────────────────────────────────────────────────────
CONFIG_BOOTCOUNT_LIMIT=y
CONFIG_BOOTCOUNT_ENV=y
CONFIG_BOOTCOUNT_BOOTLIMIT=3

# ─── MMC / SD ─────────────────────────────────────────────────────────────────
CONFIG_MMC=y
CONFIG_MMC_SDHCI=y
CONFIG_MMC_SDHCI_BCM2835=y

# ─── SPI & TPM2 — Measured Boot (v0.3.0) ─────────────────────────────────────
CONFIG_SPI=y
CONFIG_DM_SPI=y
CONFIG_BCM2835_SPI=y
CONFIG_TPM=y
CONFIG_TPM_V2=y
CONFIG_TPM2_TIS_SPI=y
CONFIG_MEASURED_BOOT=y
CONFIG_MEASURE_DEVICETREE=y

# ─── Networking ───────────────────────────────────────────────────────────────
CONFIG_NET=y
CONFIG_CMD_DHCP=y
CONFIG_CMD_TFTP=y

# ─── Useful commands ──────────────────────────────────────────────────────────
CONFIG_CMD_EXT4=y
CONFIG_CMD_FAT=y
CONFIG_CMD_FS_GENERIC=y
CONFIG_CMD_MMC=y
CONFIG_CMD_SPI=y
CONFIG_CMD_TPM=y
CONFIG_CMD_TPM_V2=y

# ─── Security hardening ───────────────────────────────────────────────────────
CONFIG_HUSH_PARSER=y
