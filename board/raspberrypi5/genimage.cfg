# genimage.cfg — Disk image layout for Raspberry Pi 5
#
# Partition layout (A/B for RAUC):
#   p1  boot      FAT32  256 MiB   — Bootloader, DTBs, TF-A, OP-TEE
#   p2  rootfs_a  ext4   512 MiB   — Active root filesystem (slot A)
#   p3  rootfs_b  ext4   512 MiB   — Backup root filesystem (slot B)
#   p4  data      ext4   256 MiB   — Persistent data (config, logs)

image boot.vfat {
    vfat {
        files = {
            "bcm2712-rpi-5-b.dtb",
            "Image",
            "config.txt",
            "cmdline.txt",
            "boot.scr",
            "start4.elf",
            "fixup4.dat",
            "bootcode.bin",
            "u-boot.bin",
            "bl31.bin",
            "tee-header_v2.bin",
            "tee-pager_v2.bin",
            "tee-pageable_v2.bin",
        }
    }
    size = 256M
}

image rootfs_a.ext4 {
    ext4 {
        label = "rootfs_a"
    }
    size = 512M
}

image rootfs_b.ext4 {
    ext4 {
        label = "rootfs_b"
    }
    size = 512M
}

image data.ext4 {
    ext4 {
        label = "data"
    }
    size = 256M
}

image sdcard.img {
    hdimage {
        gpt = true
    }

    partition boot {
        partition-type-uuid = "c12a7328-f81f-11d2-ba4b-00a0c93ec93b"
        image = "boot.vfat"
        offset = 8M
        size   = 256M
        bootable = true
    }

    partition rootfs_a {
        partition-type-uuid = "0fc63daf-8483-4772-8e79-3d69d8477de4"
        image = "rootfs_a.ext4"
    }

    partition rootfs_b {
        partition-type-uuid = "0fc63daf-8483-4772-8e79-3d69d8477de4"
        image = "rootfs_b.ext4"
    }

    partition data {
        partition-type-uuid = "0fc63daf-8483-4772-8e79-3d69d8477de4"
        image = "data.ext4"
    }
}
